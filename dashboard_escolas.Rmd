---
title: "Painel de Escolas"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(dplyr)
library(readr)
library(stringr)
library(shiny)

options(scipen = 999)
#load("df_join_cluster_finais.RData")

load("escolas_campos_sel.RData")
load("UFs_brasil.RData")

ESCOLAS<- escolas_campos_sel
rm(escolas_campos_sel)
#UFs_brasil <- read_csv("UFs_brasil - Sheet1.csv")
names(UFs_brasil)[1] <-"UF"
names(UFs_brasil)[4] <-"REGIAO"

ESCOLAS<- ESCOLAS %>%
  inner_join(UFs_brasil)

Municpios_IBGE <- read_csv("Municpios_IBGE - Sheet1.csv")

  names(Municpios_IBGE)[c(2:4)]<-c("COD_UF","CO_MUNICIPIO","NOME_MUNICIPIO")
  
  Municpios_IBGE$CO_MUNICIPIO <- paste0(Municpios_IBGE$COD_UF,Municpios_IBGE$CO_MUNICIPIO)
  
  Municpios_IBGE$CO_MUNICIPIO <- as.numeric(Municpios_IBGE$CO_MUNICIPIO)
  
  names(ESCOLAS)[2]<-"Nome_Escola" 


```


Inputs {.sidebar data-width=200}
-----------------------------------------------------------------------


```{r}

escolas_UF<- (ESCOLAS%>%
  #arrange(Nome_Escola) %>%
  mutate(escolas_estado = paste0(UF,"-",Nome_Escola)) %>%
    arrange(escolas_estado) %>%
  select(escolas_estado))$escolas_estado
  
  

selectInput ("escola_id","Escolha a escola", choices =escolas_UF, selected = escolas_UF[1] ,multiple = FALSE) 

```


Column 
-----------------------------------------------------------------------

### Biblioteca


```{r}

renderText({
  
  escola_sel<- input$escola_id
  
  escola_sel <- substr(escola_sel,4,300)
  
  
  
  dados_escola<- ESCOLAS%>%
    inner_join(Municpios_IBGE) %>%
    inner_join(UFs_brasil)%>%
    filter(Nome_Escola==escola_sel)%>%
    select(IN_BIBLIOTECA, IN_LABORATORIO_INFORMATICA, IN_QUADRA_ESPORTES, IN_INTERNET, UF, CO_MUNICIPIO,NOME_MUNICIPIO, REGIAO)
  
  
  if (dados_escola$IN_BIBLIOTECA==0){
    texto_biblioteca<- "nÃ£o tem biblioteca"
  } else{
    texto_biblioteca<- "tem biblioteca"
  }
  
  paste0("A escola selecionada ", texto_biblioteca)
})

```

